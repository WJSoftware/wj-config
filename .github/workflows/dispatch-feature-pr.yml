name: 'Dispatch: Feature PR Workflow'

on:
  workflow_dispatch:
    inputs:
      node-version:
        description: Node.js version to use.
        required: false
        type: choice
        options:
          - '18'
          - '20'
          - '22'
          - '24'
        default: '24'
      debug:
        description: Enable debug logging.
        required: false
        type: choice
        default: 'false'
        options:
          - 'true'
          - 'false'

jobs:
  log-context:
    name: Log GitHub Context
    runs-on: ubuntu-latest
    if: ${{ inputs.debug == 'true' }}
    steps:
      - name: GitHub Context JSON
        shell: pwsh
        run: |
          $json = '${{ toJSON(github) }}'
          Write-Host "GitHub Context`n`n$($json)" -BackgroundColor DarkYellow -foregroundColor Black
      
      - name: GitHub Context (Table)
        shell: pwsh
        run: |
          $context = '${{ toJSON(github) }}' | ConvertFrom-Json
          $context | Format-Table -AutoSize

  test:
    name: Unit Testing
    uses: WJSoftware/cicd/.github/workflows/npm-test.yml@v0.4
    secrets: inherit
    with:
      node-version: ${{ inputs.node-version }}
      build-script: ${{ inputs.debug == 'true' && 'build:debug' || 'build' }}
